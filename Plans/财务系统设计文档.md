# 餐食关系系统财务模块设计文档

## 1. 系统概述

### 1.1 设计目标

- **准确统计**：精确记录所有收支交易，确保财务数据的准确性
- **高效管理**：提供便捷的财务操作流程，减少人工工作量
- **智能分析**：生成多维度财务报表，为决策提供数据支持
- **员工薪资**：根据班制、工作时长、加班、陪护、护理等因素准确计算薪资
- **合规性**：符合小型公司财务管理制度和税务要求

### 1.2 核心功能

- **收支管理**：记录所有收入和支出，支持分类统计
- **报表生成**：自动生成日报、周报、月报、年报
- **薪资计算**：根据员工工作量精确计算薪资
- **财务分析**：提供财务状况分析和趋势预测
- **预算管理**：支持预算制定和执行监控

### 1.3 技术架构

- **前端**：基于Bootstrap 5的响应式界面
- **后端**：Flask RESTful API
- **数据库**：MySQL，使用SQLAlchemy ORM
- **报表**：支持导出Excel、PDF格式

## 2. 收支管理模块

### 2.1 收入管理

#### 2.1.1 收入类型

- **餐费收入**：客户餐费、套餐费用
- **订餐收入**：客户订餐费用，包括菜品费用、配送费等
- **服务费收入**：陪护费、护理费、其他服务费
- **预约定金**：客户预约时支付的定金
- **其他收入**：礼品销售、场地租赁等
- **母子服务收入**：母婴护理、产后恢复、新生儿护理等服务收入
  - **产后恢复服务收入**：产后身体恢复、心理疏导等服务收入
  - **新生儿护理服务收入**：新生儿日常护理、专业护理等服务收入
  - **母婴套餐收入**：包含多项服务的综合套餐收入
  - **母子服务产品收入**：相关产品销售、耗材费用等收入

#### 2.1.2 收入流程

1. **收入登记**：手动录入或通过系统自动生成
2. **收入确认**：验证收入的真实性和完整性
3. **收入分类**：根据收入类型进行分类
4. **收入统计**：实时统计收入数据
5. **收入追溯**：关联相关业务单据，确保可追溯性

#### 2.1.3 收入记录字段

| 字段名           | 数据类型 | 描述          |
| ---------------- | -------- | ------------- |
| id               | INTEGER  | 收入ID        |
| amount           | DECIMAL  | 金额          |
| category         | VARCHAR  | 分类          |
| source           | VARCHAR  | 来源          |
| transaction_date | DATETIME | 交易日期      |
| payment_method   | VARCHAR  | 支付方式      |
| transaction_no   | VARCHAR  | 交易单号      |
| customer_id      | INTEGER  | 客户ID        |
| description      | TEXT     | 描述          |
| status           | VARCHAR  | 状态          |
| receipt_url      | VARCHAR  | 收据/凭证链接 |
| created_by       | INTEGER  | 创建人ID      |
| created_at       | DATETIME | 创建时间      |
| updated_at       | DATETIME | 更新时间      |

### 2.2 支出管理

#### 2.2.1 支出类型

- **食材采购**：蔬菜、肉类、调料等食材采购
- **员工薪资**：基本工资、加班费、津贴等
- **供应商付款**：向供应商支付的货款
- **设备采购**：厨房设备、办公设备等
- **水电费**：水、电、燃气等费用
- **办公费用**：办公用品、耗材等
- **差旅费**：员工出差相关费用
- **行政费用**：日常行政开支
- **员工报销**：员工报账费用
- **其他支出**：维修费用、杂项支出等

#### 2.2.2 支出流程

1. **支出申请**：填写支出申请单
2. **审批流程**：根据金额大小设置不同审批级别
3. **支出执行**：完成支付操作
4. **支出记录**：记录支出详情
5. **支出追溯**：关联相关审批单据和凭证

#### 2.2.3 支出记录字段

| 字段名            | 数据类型 | 描述          |
| ----------------- | -------- | ------------- |
| id                | INTEGER  | 支出ID        |
| amount            | DECIMAL  | 金额          |
| category          | VARCHAR  | 分类          |
| recipient         | VARCHAR  | 收款人        |
| recipient_account | VARCHAR  | 收款人账户    |
| transaction_date  | DATETIME | 交易日期      |
| payment_method    | VARCHAR  | 支付方式      |
| transaction_no    | VARCHAR  | 交易单号      |
| supplier_id       | INTEGER  | 供应商ID      |
| employee_id       | INTEGER  | 员工ID        |
| description       | TEXT     | 描述          |
| status            | VARCHAR  | 状态          |
| approval_by       | INTEGER  | 审批人ID      |
| receipt_url       | VARCHAR  | 收据/凭证链接 |
| created_by        | INTEGER  | 创建人ID      |
| created_at        | DATETIME | 创建时间      |
| updated_at        | DATETIME | 更新时间      |

### 2.3 收支明细管理

#### 2.3.1 明细记录

- **逐笔记录**：每笔交易都有详细记录
- **关联管理**：与相关业务（客户订单、采购订单、薪资发放、报销申请）关联
- **状态跟踪**：记录交易的完整生命周期
- **凭证管理**：上传和管理交易凭证

#### 2.3.2 明细查询

- **多维度查询**：按日期、类型、金额、状态等查询
- **模糊搜索**：支持关键词搜索
- **导出功能**：支持导出Excel格式
- **打印功能**：支持打印凭证和报表

#### 2.3.3 收支对账

- **自动对账**：与银行流水、支付平台交易记录自动对账
- **差异提醒**：发现对账差异时及时提醒
- **对账报表**：生成对账结果报表
- **对账历史**：记录对账历史和结果

### 2.4 支付管理

#### 2.4.1 支付方式

- **微信支付**：支持微信扫码支付、微信转账
- **支付宝**：支持支付宝扫码支付、支付宝转账
- **银行刷卡**：支持POS机刷卡支付
- **银行转账**：支持对公账户转账
- **现金**：支持现金支付

#### 2.4.2 支付流程

1. **支付发起**：系统或人工发起支付请求
2. **支付审批**：根据金额大小进行审批
3. **支付执行**：通过选定的支付方式执行支付
4. **支付确认**：确认支付结果
5. **支付记录**：记录支付详情

#### 2.4.3 退款流程

1. **退款申请**：提交退款申请
2. **退款审批**：审核退款原因和金额
3. **退款执行**：通过原支付方式执行退款
4. **退款确认**：确认退款结果
5. **退款记录**：记录退款详情

### 2.5 进、销、存管理

#### 2.5.1 进货管理

- **采购计划**：根据库存和需求生成采购计划
- **采购订单**：创建和管理采购订单
- **入库管理**：记录商品入库信息
- **供应商管理**：管理供应商信息和联系方式

#### 2.5.2 销售管理

- **销售订单**：创建和管理销售订单
- **出库管理**：记录商品出库信息
- **客户管理**：管理客户信息和联系方式
- **销售统计**：统计销售数据和趋势

#### 2.5.3 库存管理

- **库存跟踪**：实时跟踪库存水平
- **库存预警**：设置库存预警阈值
- **库存盘点**：定期进行库存盘点
- **库存报表**：生成库存状态和变动报表

### 2.6 资金往来凭据管理

#### 2.6.1 凭据类型

- **发票**：增值税发票、普通发票
- **收据**：收款收据、付款收据
- **银行回单**：银行转账回单
- **支付凭证**：微信、支付宝支付凭证
- **报销单**：员工报销单据

#### 2.6.2 凭据管理流程

1. **凭据收集**：收集和整理各类凭据
2. **凭据审核**：审核凭据的真实性和完整性
3. **凭据归档**：将凭据数字化并归档
4. **凭据查询**：支持按条件查询凭据
5. **凭据销毁**：按规定销毁过期凭据

#### 2.6.3 凭据安全管理

- **数字加密**：对敏感凭据进行加密存储
- **访问控制**：严格控制凭据访问权限
- **备份管理**：定期备份凭据数据
- **审计日志**：记录凭据操作日志

## 3. 员工工作量统计与薪资计算

### 3.1 员工工作分配管理

#### 3.1.1 工作分配流程

1. **工作创建**：管理层创建工作任务
2. **任务分配**：将任务分配给具体员工
3. **任务确认**：员工确认接受任务
4. **任务执行**：员工执行工作任务
5. **任务完成**：员工提交任务完成情况
6. **任务审核**：管理层审核任务完成质量

#### 3.1.2 工作内容说明

- **任务名称**：工作任务的名称
- **任务描述**：详细描述工作内容和要求
- **任务类型**：工作任务的类型（如陪护、护理、行政等）
- **任务时长**：预计完成任务所需的时间
- **任务截止**：任务完成的截止日期
- **任务优先级**：任务的优先级级别

#### 3.1.3 工作量统计

##### 3.1.3.1 工作类型

- **正常工作**：标准工作时间内的工作
- **加班工作**：超出标准工作时间的工作
- **陪护工作**：专门的陪护服务工作
- **护理工作**：专门的护理服务工作
- **行政工作**：日常行政事务工作
- **其他工作**：不属于以上类别的工作

##### 3.1.3.2 工作量数据来源

- **考勤系统**：自动获取打卡记录，计算工作时长
- **排班系统**：根据排班计划确定工作时间
- **任务系统**：根据任务完成情况统计工作量
- **手动录入**：特殊工作内容的手动录入
- **系统记录**：系统自动记录的工作内容

##### 3.1.3.3 工作量统计维度

- **按员工**：统计每位员工的工作量
- **按部门**：统计各部门的工作量
- **按时间**：统计不同时间段的工作量
- **按工作类型**：统计不同类型工作的工作量
- **按任务**：统计各任务的工作量

### 3.6 工作量统计与提示机制

#### 3.6.1 工作量统计方法

##### 3.6.1.1 数据收集

- **自动采集**：
  * 从AttendanceRecord表获取考勤数据
  * 从WorkAssignment表获取工作分配数据
  * 从TaskCompletion表获取任务完成数据
  * 从ServiceBooking表获取服务预约数据
- **手动录入**：
  * 特殊工作内容的手动记录
  * 工作量调整的手动录入

##### 3.6.1.2 工作量计算

- **时间维度计算**：
  * 日工作量：当日实际工作时长
  * 周工作量：当周实际工作时长总和
  * 月工作量：当月实际工作时长总和
  * 季度工作量：当季度实际工作时长总和
  * 年工作量：当年实际工作时长总和
- **任务维度计算**：
  * 完成任务数量
  * 完成任务质量
  * 任务完成效率
- **服务维度计算**：
  * 完成服务预约数量
  * 服务时长
  * 服务满意度

##### 3.6.1.3 工作量分析

- **个人工作量分析**：
  * 工作量趋势变化
  * 工作量分布
  * 与目标工作量的对比
- **团队工作量分析**：
  * 部门工作量分布
  * 团队成员工作量平衡度
  * 部门工作量趋势
- **工作类型分析**：
  * 不同类型工作的占比
  * 各类工作的效率分析
  * 工作类型分布的合理性

#### 3.6.2 工作量提示机制

##### 3.6.2.1 预警类型

- **工作量不足预警**：
  * 员工工作量低于标准工作量的80%
  * 部门工作量低于计划工作量的80%
- **工作量过载预警**：
  * 员工工作量超过标准工作量的120%
  * 部门工作量超过计划工作量的120%
- **工作量不平衡预警**：
  * 团队成员工作量差异过大
  * 部门间工作量分配不均
- **任务超时预警**：
  * 任务即将到期
  * 任务已超时未完成

##### 3.6.2.2 预警阈值设置

- **个人工作量阈值**：
  * 不足阈值：标准工作量的80%
  * 过载阈值：标准工作量的120%
- **部门工作量阈值**：
  * 不足阈值：计划工作量的80%
  * 过载阈值：计划工作量的120%
- **任务超时阈值**：
  * 警告阈值：任务截止日前3天
  * 严重阈值：任务截止日前1天

##### 3.6.2.3 预警流程

1. **数据采集**：定期采集工作量数据
2. **阈值判断**：将实际工作量与预警阈值比较
3. **预警生成**：生成WorkloadAlert记录
4. **预警通知**：
   * 系统通知
   * 邮件通知
   * 短信通知
   * 微信通知
5. **预警处理**：
   * 确认预警
   * 分析原因
   * 采取措施
   * 记录处理结果

##### 3.6.2.4 预警级别

- **信息级**：工作量轻微偏离，提醒关注
- **警告级**：工作量明显偏离，需要采取措施
- **严重级**：工作量严重偏离，必须立即处理

#### 3.6.3 工作量管理工具

- **工作量仪表盘**：
  * 个人工作量概览
  * 团队工作量分布
  * 工作量趋势图表
- **工作量报表**：
  * 日报、周报、月报、年报
  * 工作量分析报表
  * 预警记录报表
- **工作量调整工具**：
  * 任务重新分配
  * 工作量调整申请
  * 加班申请处理

#### 3.6.4 工作量与薪资关联

- **工作量影响因素**：
  * 工作量作为绩效评分的重要指标
  * 工作量与奖金发放挂钩
  * 工作量与晋升评估相关
- **工作量激励机制**：
  * 超额完成工作量的奖励
  * 工作量达标率的考核
  * 工作量效率的提升奖励

### 3.7 工作量储备不足的计算方法

#### 3.7.1 概念定义

- **工作量储备**：企业为完成预期工作任务而配备的人力资源总量
- **工作量储备不足**：现有人力资源无法满足预期工作任务需求的情况
- **工作负载率**：实际工作量与可用人力资源的比率

#### 3.7.2 计算方法

##### 3.7.2.1 人力资源需求计算

- **公式**：人力资源需求 = Σ（任务预计工作量 ÷ 人均工作效率）
- **任务预计工作量**：各任务的预计工作时长总和
- **人均工作效率**：单位时间内完成的工作量

##### 3.7.2.2 工作量储备计算

- **公式**：工作量储备 = 现有员工数量 × 人均可用工作时长 × 工作效率系数
- **人均可用工作时长**：扣除法定节假日、休息日和必要缺勤后的工作时长
- **工作效率系数**：考虑工作强度、技能水平等因素的调整系数

##### 3.7.2.3 工作量储备不足计算

- **公式**：工作量储备不足 = 人力资源需求 - 工作量储备
- **储备不足率**：（工作量储备不足 ÷ 人力资源需求）× 100%

##### 3.7.2.4 工作负载率计算

- **公式**：工作负载率 = （实际工作量 ÷ 工作量储备）× 100%
- **负载率等级**：
  * 低负载：负载率 < 70%
  * 正常负载：70% ≤ 负载率 ≤ 100%
  * 高负载：100% < 负载率 ≤ 120%
  * 超负荷：负载率 > 120%

#### 3.7.3 预警机制

##### 3.7.3.1 预警阈值

- **轻微不足**：储备不足率 < 5%
- **中度不足**：5% ≤ 储备不足率 < 10%
- **严重不足**：储备不足率 ≥ 10%

##### 3.7.3.2 预警指标

- **人员缺口**：需要补充的员工数量
- **工时缺口**：需要增加的工作时长
- **任务积压**：预计无法按时完成的任务数量
- **服务质量风险**：因工作量储备不足可能导致的服务质量下降风险

##### 3.7.3.3 预警流程

1. **数据收集**：

   - 收集待完成任务的预计工作量
   - 收集现有员工的可用工作时长
   - 收集历史工作效率数据
2. **计算分析**：

   - 计算人力资源需求
   - 计算工作量储备
   - 计算储备不足率和工作负载率
3. **预警生成**：

   - 根据计算结果生成相应级别的预警
   - 生成WorkloadAlert记录
   - 通知相关管理人员
4. **预警处理**：

   - 分析储备不足的原因
   - 制定应对措施
   - 跟踪措施执行效果

#### 3.7.4 应对措施

##### 3.7.4.1 短期措施

- **调整工作时间**：

  * 安排加班
  * 调整工作班次
  * 灵活安排工作时间
- **优化工作流程**：

  * 简化工作流程
  * 消除不必要的环节
  * 提高工作效率
- **任务重新分配**：

  * 调整任务分配，平衡工作量
  * 优先处理重要任务
  * 推迟非紧急任务

##### 3.7.4.2 中期措施

- **人员调整**：

  * 临时雇佣兼职人员
  * 跨部门借调人员
  * 外包部分工作
- **培训提升**：

  * 开展技能培训，提高员工工作效率
  * 交叉培训，增强员工多能性
  * 培训新员工，快速融入工作

##### 3.7.4.3 长期措施

- **人员规划**：

  * 根据业务发展规划，制定人力资源计划
  * 建立人才储备机制
  * 优化招聘流程，及时补充人员
- **流程优化**：

  * 引入自动化工具，减少人工工作量
  * 优化业务流程，提高整体效率
  * 建立标准化工作流程，减少重复工作
- **组织结构调整**：

  * 优化部门结构，提高组织效率
  * 调整岗位职责，明确工作边界
  * 建立灵活的团队结构，适应业务变化

#### 3.7.5 监控与评估

- **定期监控**：

  * 每周监控工作量储备情况
  * 每月评估人力资源需求
  * 每季度调整人力资源计划
- **效果评估**：

  * 评估应对措施的有效性
  * 分析工作量储备不足的根本原因
  * 持续改进预警机制和应对策略
- **报表生成**：

  * 工作量储备不足分析报表
  * 人力资源需求预测报表
  * 工作负载率趋势报表

### 3.2 员工报账管理

#### 3.2.1 报账类型

- **出差报销**：交通费、住宿费、餐饮费、其他费用
- **日常行政费用**：办公用品、办公耗材、快递费、其他费用
- **业务招待费**：客户招待、合作伙伴招待等费用
- **其他报销**：不属于以上类别的费用

#### 3.2.2 报账流程

1. **报销申请**：员工填写报销申请单
2. **凭证上传**：上传相关费用凭证
3. **部门审批**：部门负责人审批
4. **财务审核**：财务部门审核
5. **报销支付**：通过指定支付方式发放报销款
6. **报销记录**：记录报销详情

#### 3.2.3 报账数据管理

- **报销申请表**：包含报销人、报销日期、报销金额、报销事由等
- **费用明细**：详细列出每笔费用的金额和用途
- **凭证管理**：上传和管理费用凭证
- **报销历史**：记录员工报销历史
- **报销统计**：统计报销数据和趋势

### 3.3 薪资计算

#### 3.3.1 薪资构成

- **基本工资**：根据职位和级别确定的固定薪资
- **加班费**：超出标准工作时间的加班费用
- **陪护津贴**：陪护工作的额外津贴
- **护理津贴**：护理工作的额外津贴
- **绩效奖金**：根据工作表现发放的奖金
- **其他津贴**：交通补贴、餐饮补贴等
- **扣除项**：社保、个税、罚款等

#### 3.3.2 计算规则

##### 3.3.2.1 加班费计算

- **平日加班**：基本工资 ÷ 21.75 ÷ 8 × 1.5 × 加班时长
- **周末加班**：基本工资 ÷ 21.75 ÷ 8 × 2 × 加班时长
- **法定节假日加班**：基本工资 ÷ 21.75 ÷ 8 × 3 × 加班时长

##### 3.3.2.2 陪护/护理津贴计算

- **陪护津贴**：陪护时长 × 陪护津贴标准
- **护理津贴**：护理时长 × 护理津贴标准

##### 3.3.2.3 绩效奖金计算

- **个人绩效**：根据个人工作表现评分
- **部门绩效**：根据部门整体表现评分
- **公司绩效**：根据公司整体表现评分

### 3.5 奖金发放管理

#### 3.5.1 奖金类型

- **绩效奖金**：根据员工工作表现发放的奖金
- **年度奖金**：年度结束时根据全年表现发放的奖金
- **项目奖金**：项目完成时根据项目成果发放的奖金
- **特殊奖金**：对有特殊贡献的员工发放的奖金
- **团队奖金**：对表现优秀的团队发放的奖金

#### 3.5.2 奖金计算方法

##### 3.5.2.1 绩效奖金计算

- **计算公式**：绩效奖金基数 × 绩效评分系数
- **绩效评分系数**：
  * 优秀（90-100分）：1.2-1.5
  * 良好（80-89分）：1.0-1.2
  * 合格（70-79分）：0.8-1.0
  * 不合格（70分以下）：0-0.8
- **绩效评分维度**：
  * 工作质量：任务完成的质量和准确性
  * 工作效率：任务完成的速度和及时性
  * 工作态度：工作积极性和责任心
  * 团队合作：与团队成员的协作能力
  * 创新能力：提出的改进建议和创新方案

##### 3.5.2.2 年度奖金计算

- **计算公式**：（基本工资 × 年度绩效系数 × 工作时间系数） + 公司效益奖金
- **年度绩效系数**：基于全年绩效评估结果
- **工作时间系数**：根据当年工作月份计算
- **公司效益奖金**：根据公司年度盈利情况分配

##### 3.5.2.3 项目奖金计算

- **计算公式**：项目奖金总额 × 个人贡献系数
- **项目奖金总额**：根据项目预算和项目成果确定
- **个人贡献系数**：基于个人在项目中的角色和贡献度

##### 3.5.2.4 特殊奖金计算

- **计算方法**：根据特殊贡献的价值和影响程度确定
- **审批流程**：由管理层审批确定

#### 3.5.3 奖金发放流程

1. **奖金计划制定**：

   - 制定奖金发放计划和预算
   - 确定奖金发放的范围和标准
   - 明确奖金计算方法和审批流程
2. **奖金评估**：

   - 收集员工工作表现数据
   - 评估员工绩效和贡献
   - 计算初步奖金金额
3. **奖金审批**：

   - 生成BonusRecord记录
   - 提交奖金审批流程
   - 管理层审核奖金分配方案
   - 确认或调整奖金金额
4. **奖金发放**：

   - 将审批通过的奖金添加到薪资计算中
   - 或单独发放奖金
   - 更新BonusRecord的支付状态
   - 记录交易单号
5. **奖金回退**：

   - 处理奖金发放错误的情况
   - 回退已发放的奖金
   - 更新相关记录状态

#### 3.5.4 奖金管理

- **奖金预算**：制定和监控奖金预算
- **奖金报表**：生成奖金发放报表
- **奖金分析**：分析奖金发放情况和效果
- **奖金调整**：根据实际情况调整奖金策略

#### 3.3.3 薪资计算流程

1. **数据收集**：获取员工的考勤、排班、工作量记录
2. **基础计算**：计算基本工资、加班费、津贴等
3. **扣除计算**：计算社保、个税等扣除项
4. **汇总计算**：计算最终实发薪资
5. **薪资审核**：提交审核，确认薪资计算结果
6. **薪资发放**：通过银行、微信支付、支付宝等方式发放

### 3.4 薪资管理

#### 3.4.1 薪资周期

- **月度薪资**：每月固定日期发放
- **临时薪资**：特殊情况下的临时发放
- **年终奖金**：年度结束时发放的奖金
- **项目奖金**：项目完成时发放的奖金

#### 3.4.2 薪资发放流程

1. **薪资计算**：完成薪资计算和审核
2. **薪资确认**：员工确认薪资明细
3. **薪资发放**：通过选定的支付方式发放薪资
4. **发放确认**：确认薪资发放结果
5. **薪资签收**：员工签收薪资
6. **薪资回退**：处理薪资发放异常情况

#### 3.4.3 工资总额测算

- **人员编制**：根据人员编制测算薪资总额
- **薪资调整**：根据薪资调整计划测算薪资总额
- **奖金预算**：根据奖金计划测算奖金总额
- **人力成本**：综合测算人力成本

#### 3.4.4 工资单管理

- **工资单创建**：生成员工工资单
- **工资单查询**：查询员工工资单
- **工资单修改**：修改工资单信息
- **工资单删除**：删除错误的工资单
- **工资单导出**：导出工资单为Excel格式

#### 3.4.5 薪资报表

- **个人薪资明细**：每位员工的薪资构成明细
- **部门薪资汇总**：各部门的薪资总额和平均薪资
- **公司薪资分析**：公司整体薪资支出分析
- **薪资趋势分析**：薪资支出的变化趋势分析

#### 3.4.6 薪资调整

- **调薪管理**：记录员工薪资调整历史
- **调薪审批**：调薪申请的审批流程
- **调薪报表**：调薪情况的统计报表

## 4. 报表生成模块

### 4.1 报表类型

#### 4.1.1 收支报表

- **日报**：每日收支明细和汇总
- **周报**：每周收支明细和汇总
- **月报**：每月收支明细和汇总，包括预算执行情况
- **季报**：每季度收支分析和趋势
- **年报**：年度收支总结和财务状况分析
- **订餐收入报表**：订餐收入明细、菜品销售统计、配送费统计
- **库存成本报表**：食材采购成本、库存价值、库存周转率
- **配送成本报表**：配送人员成本、车辆成本、配送效率分析

#### 4.1.2 财务状况报表

- **资产负债表**：反映公司财务状况
- **利润表**：反映公司经营成果
- **现金流量表**：反映公司资金流动情况

#### 4.1.3 薪资报表

- **个人薪资报表**：员工个人薪资明细
- **部门薪资报表**：部门薪资汇总和分析
- **公司薪资报表**：公司整体薪资支出分析

#### 4.1.4 自定义报表

- **多维度分析**：支持按不同维度组合生成报表
- **数据筛选**：支持自定义筛选条件
- **图表展示**：支持柱状图、折线图、饼图等多种图表

### 4.2 报表生成

#### 4.2.1 生成方式

- **自动生成**：系统定时自动生成报表
- **手动生成**：用户手动触发生成报表
- **实时生成**：根据实时数据生成报表

#### 4.2.2 报表格式

- **Excel**：支持导出Excel格式，便于进一步编辑和分析
- **PDF**：支持导出PDF格式，便于打印和归档
- **HTML**：系统内在线查看的HTML格式

#### 4.2.3 报表内容

- **表头**：报表名称、生成日期、统计周期
- **表体**：详细数据内容，支持排序和筛选
- **表尾**：汇总数据、备注信息
- **图表**：数据可视化图表

### 4.3 报表分析

#### 4.3.1 趋势分析

- **收支趋势**：分析收支的变化趋势
- **收入构成**：分析不同收入来源的占比
- **支出构成**：分析不同支出类别的占比
- **薪资趋势**：分析薪资支出的变化趋势

#### 4.3.2 对比分析

- **同比分析**：与去年同期数据对比
- **环比分析**：与上一周期数据对比
- **预算对比**：与预算数据对比

#### 4.3.3 预警功能

- **收支异常预警**：当收支出现异常时发出预警
- **预算超支预警**：当支出接近或超出预算时发出预警
- **薪资异常预警**：当薪资计算出现异常时发出预警

## 5. 预算管理模块

### 5.1 预算制定

#### 5.1.1 预算类型

- **年度预算**：全年的财务预算
- **季度预算**：每季度的财务预算
- **月度预算**：每月的财务预算
- **专项预算**：特定项目的预算

#### 5.1.2 预算编制

- **自上而下**：管理层制定总体预算，再分解到各部门
- **自下而上**：各部门编制本部门预算，再汇总到管理层
- **混合编制**：结合以上两种方式

#### 5.1.3 预算调整

- **预算追加**：当实际需求超出预算时申请追加
- **预算调剂**：在不同预算项目之间进行调剂
- **预算冻结**：暂时冻结部分预算

### 5.2 预算执行

#### 5.2.1 执行监控

- **实时监控**：实时监控预算执行情况
- **执行率计算**：计算预算执行率，反映预算使用情况
- **预警机制**：当预算执行接近阈值时发出预警

#### 5.2.2 执行分析

- **差异分析**：分析预算执行与预算的差异
- **原因分析**：分析差异产生的原因
- **调整建议**：根据差异分析提出预算调整建议

### 5.3 预算报表

- **预算执行报表**：反映预算执行情况
- **预算差异报表**：反映预算与实际的差异
- **预算调整报表**：反映预算调整情况

## 6. 数据流程

### 6.1 收支数据流程

1. **数据录入**：通过前端界面或API录入收支数据
2. **数据验证**：系统验证数据的完整性和准确性
3. **数据存储**：将数据存储到数据库
4. **数据处理**：进行分类、汇总等处理
5. **报表生成**：根据处理后的数据生成报表

### 6.2 薪资数据流程

1. **数据收集**：

   - 从AttendanceRecord表获取员工考勤记录（打卡时间、工作时长、加班时长）
   - 从WorkSchedule表获取员工排班信息
   - 从OvertimeApplication表获取审批通过的加班申请
   - 从LeaveApplication表获取请假记录
   - 从WorkloadRecord表获取工作量统计数据
   - 从WorkAssignment表获取服务预约相关的工作分配
2. **工作量统计**：

   - 统计员工实际工作时长（基于考勤记录）
   - 统计加班时长（区分平日、周末、法定节假日）
   - 统计陪护、护理等特殊工作时长
   - 统计完成的任务数量和服务预约数量
   - 计算员工生产力评分
3. **薪资计算**：

   - 基本工资：基于User表中的basic_salary字段
   - 加班费计算：
     * 平日加班：基本工资 ÷ 21.75 ÷ 8 × 1.5 × 加班时长
     * 周末加班：基本工资 ÷ 21.75 ÷ 8 × 2 × 加班时长
     * 法定节假日加班：基本工资 ÷ 21.75 ÷ 8 × 3 × 加班时长
   - 津贴计算：基于User表中的allowance字段
   - 奖金计算：基于BonusRecord表中的审批通过的奖金
   - 扣除项计算：
     * 社保：根据当地社保政策计算
     * 个税：根据个人所得税累进税率计算
     * 其他扣除项：如罚款、借款等
   - 计算实发薪资：总收入 - 总扣除
4. **薪资审核**：

   - 生成PayrollRecord记录
   - 提交PayrollApproval审批流程
   - 审批人审核薪资计算结果
   - 确认或驳回审批
5. **薪资发放**：

   - 通过银行转账、微信支付、支付宝等方式发放
   - 更新PayrollRecord的支付状态
   - 记录交易单号
6. **数据存储**：

   - 将薪资计算结果存储到PayrollRecord表
   - 将薪资明细存储到PayrollItem表
   - 将发放记录存储到相关支付系统

### 6.3 薪资计算详细方法

#### 6.3.1 基本工资计算

- **固定薪资制**：直接使用User表中的basic_salary字段
- **计时薪资制**：实际工作时长 × hourly_rate
- **计件薪资制**：完成任务数量 × 单价

#### 6.3.2 加班费计算

- **平日加班**：(basic_salary ÷ 21.75 ÷ 8) × 1.5 × 加班时长
- **周末加班**：(basic_salary ÷ 21.75 ÷ 8) × 2 × 加班时长
- **法定节假日加班**：(basic_salary ÷ 21.75 ÷ 8) × 3 × 加班时长

#### 6.3.3 津贴计算

- **固定津贴**：直接使用User表中的allowance字段
- **特殊津贴**：
  * 陪护津贴：陪护时长 × 陪护津贴标准
  * 护理津贴：护理时长 × 护理津贴标准
  * 交通补贴：根据出勤天数计算
  * 餐饮补贴：根据出勤天数计算

#### 6.3.4 奖金计算

- **绩效奖金**：个人绩效评分 × 绩效奖金基数
- **项目奖金**：项目完成情况 × 项目奖金分配比例
- **年终奖金**：年度工作表现 × 年终奖金基数
- **特殊奖金**：根据特殊贡献发放

#### 6.3.5 扣除项计算

- **社保**：

  * 养老保险：工资基数 × 个人缴费比例
  * 医疗保险：工资基数 × 个人缴费比例
  * 失业保险：工资基数 × 个人缴费比例
  * 工伤保险：由公司承担
  * 生育保险：由公司承担
- **个税**：

  * 应纳税所得额 = 总收入 - 起征点 - 社保个人部分 - 专项扣除 - 专项附加扣除
  * 根据应纳税所得额对应税率表计算
- **其他扣除项**：

  * 罚款：根据公司规定
  * 借款：员工借款扣除
  * 其他：如工会会费等

#### 6.3.6 实发薪资计算

- 实发薪资 = 基本工资 + 加班费 + 津贴 + 奖金 + 其他收入 - 社保 - 个税 - 其他扣除项

### 6.4 报表数据流程

1. **数据提取**：从数据库提取原始数据
2. **数据加工**：进行数据清洗、转换、汇总
3. **数据分析**：进行趋势分析、对比分析等
4. **报表生成**：生成报表文件
5. **报表分发**：通过邮件、系统通知等方式分发报表

## 7. 系统集成

### 7.1 与其他模块的集成

#### 7.1.1 与客户模块集成

- **客户消费记录**：自动从客户订单生成收入记录
- **客户退款**：处理客户退款，生成支出记录
- **客户信用管理**：记录客户信用状况，影响财务决策
- **客户服务记录查询**：集成客户服务记录查询功能，支持查询一段时间内客户接受的服务、餐食情况和孩子服务情况

#### 7.1.1.1 客户服务记录查询功能

- **服务记录查询**：查询客户在指定时间段内接受的所有服务，包括服务类型、日期、时间、时长、服务人员等详细信息
- **餐食记录查询**：查询客户在指定时间段内的所有餐食情况，包括餐食类型、日期、菜品、数量等详细信息
- **孩子服务记录查询**：查询客户孩子在指定时间段内接受的所有服务，包括服务类型、日期、时间、时长、服务人员、生命体征、喂养记录、睡眠记录等详细信息
- **详细记录查询**：提供详细的服务记录，支持按多种条件筛选和排序
- **查询记录打印**：支持将查询结果打印出来，包括PDF、Excel等格式

#### 7.1.1.2 统计和提示机制

- **服务统计**：统计客户服务次数、时长、费用等数据
- **餐食统计**：统计客户餐食次数、类型分布、营养摄入等数据
- **孩子服务统计**：统计孩子服务次数、时长、生命体征趋势等数据
- **工作量统计**：统计服务人员工作量，支持多维度分析
- **储备不足提示**：根据工作量储备不足的计算方法，提示人力资源储备情况

#### 7.1.1.3 储备不足计算方法

- **人力资源需求计算**：根据任务预计工作量和人均工作效率计算人力资源需求
- **工作量储备计算**：根据现有员工数量、人均可用工作时长和工作效率系数计算工作量储备
- **储备不足率计算**：计算工作量储备不足的程度
- **工作负载率计算**：计算实际工作量与可用人力资源的比率
- **预警机制**：根据储备不足率和工作负载率生成相应级别的预警

#### 7.1.2 与员工模块集成

- **员工考勤数据**：获取员工打卡记录，用于薪资计算
- **员工排班数据**：获取员工排班信息，用于工作量统计
- **员工信息**：获取员工基本信息，用于薪资管理
- **员工报账**：处理员工报销申请，更新财务记录

#### 7.1.3 与采购模块集成

- **采购订单**：自动从采购订单生成支出记录
- **供应商付款**：处理供应商付款，更新财务记录
- **采购发票**：管理采购发票，用于税务申报
- **入库管理**：与库存管理系统集成，记录入库成本

#### 7.1.4 与支付模块集成

- **支付交易**：获取支付平台的交易记录，更新财务记录
- **退款处理**：处理支付退款，更新财务记录
- **交易对账**：与支付平台进行对账，确保财务数据准确性
- **支付方式管理**：统一管理各种支付方式

#### 7.1.5 与母子服务模块集成

- **服务收入**：自动从母子服务订单生成收入记录，支持按服务类型、套餐类型分类统计
- **服务支出**：处理母子服务相关支出，包括人员成本、耗材成本、设备成本等，更新财务记录
- **服务结算**：管理母子服务的结算流程，支持预付费、分期付款、后付费等多种结算方式
- **服务报表**：生成母子服务财务报表，包括收入分析、成本分析、利润率分析
- **母子服务财务分析**：分析不同母子服务项目的盈利能力、客户消费偏好、季节性趋势
- **服务人员薪资**：与员工模块集成，根据母子服务工作量计算服务人员薪资和绩效奖金
- **服务套餐定价**：基于成本分析和市场调研，支持母子服务套餐的合理定价
- **母子服务财务预警**：监控母子服务财务指标，及时发现异常情况并发出预警

### 7.2 与外部系统的集成

#### 7.2.1 银行系统集成

- **银行对账**：自动与银行流水进行对账
- **批量付款**：支持通过银行系统批量发放薪资和供应商付款

#### 7.2.2 税务系统集成

- **税务申报**：生成税务申报所需的报表和数据
- **发票管理**：管理增值税发票，支持电子发票

#### 7.2.3 财务软件集成

- **数据导出**：支持导出标准格式数据，导入到其他财务软件
- **数据导入**：支持从其他财务软件导入数据

## 8. 安全与合规

### 8.1 数据安全

- **数据加密**：敏感财务数据加密存储
- **访问控制**：严格的权限控制，只有授权人员可以访问财务数据
- **操作日志**：记录所有财务操作，便于审计
- **数据备份**：定期备份财务数据，确保数据安全

### 8.2 合规性

- **税务合规**：符合税务法规要求，支持税务申报
- **财务制度**：符合小型公司财务管理制度
- **审计要求**：支持内部审计和外部审计
- **数据真实性**：确保财务数据的真实性和完整性

### 8.3 风险控制

- **预算控制**：通过预算管理控制财务风险
- **审批流程**：重要财务操作需要审批
- **异常监控**：监控异常财务行为，及时发现风险
- **内部审计**：定期进行内部审计，发现和解决问题

## 9. 用户界面设计

### 9.1 总体布局

- **顶部导航**：财务模块入口、用户信息、通知中心
- **侧边菜单**：收支管理、报表生成、薪资管理、预算管理
- **主内容区**：根据功能模块显示不同内容
- **底部信息**：版权信息、联系方式

### 9.2 核心页面

#### 9.2.1 收支管理页面

- **收支概览**：显示收支汇总和趋势
- **收支明细**：表格形式显示收支明细，支持筛选和排序
- **添加收支**：表单形式添加新的收支记录
- **收支分类**：管理收支分类

#### 9.2.2 报表管理页面

- **报表列表**：显示可生成的报表类型
- **报表生成**：设置报表参数，生成报表
- **报表查看**：在线查看报表内容
- **报表导出**：导出报表为Excel、PDF格式

#### 9.2.3 薪资管理页面

- **薪资概览**：显示薪资支出汇总和趋势
- **薪资计算**：设置薪资参数，计算员工薪资
- **薪资明细**：查看员工薪资明细
- **薪资发放**：处理薪资发放

#### 9.2.4 预算管理页面

- **预算设置**：设置年度、季度、月度预算
- **预算执行**：查看预算执行情况
- **预算分析**：分析预算执行差异

### 9.3 响应式设计

- **PC端**：完整功能，多列布局
- **PAD端**：核心功能，适配中等屏幕
- **移动端**：简化功能，适配小屏幕
- **微信小程序**：基本查询功能，便于随时随地查看财务状况

## 10. 实施计划

### 10.1 开发阶段

1. **需求分析**：详细分析财务系统需求
2. **系统设计**：设计系统架构、数据库结构、API接口
3. **前端开发**：开发财务系统前端界面
4. **后端开发**：开发财务系统后端API
5. **集成测试**：测试系统各模块的集成
6. **用户测试**：邀请用户进行测试，收集反馈
7. **系统部署**：部署系统到生产环境
8. **人员培训**：培训财务人员使用系统

### 10.2 测试计划

- **功能测试**：测试所有功能模块
- **性能测试**：测试系统响应速度和并发处理能力
- **安全测试**：测试系统安全性
- **兼容性测试**：测试系统在不同浏览器和设备上的兼容性
- **数据测试**：测试数据准确性和完整性

### 10.3 上线计划

- **试点运行**：选择部分功能进行试点运行
- **全面上线**：系统全面上线运行
- **持续优化**：根据用户反馈持续优化系统

## 11. 总结

本财务系统设计文档详细描述了餐食关系系统的财务模块，包括收支管理、报表生成、薪资计算等核心功能。系统设计充分考虑了小型公司的财务需求，特别是员工工作量统计和薪资计算功能，能够根据班制、工作时长、加班、陪护、护理等因素准确计算薪资。

系统采用现代化技术架构，支持多平台访问，提供了直观友好的用户界面和强大的功能，能够帮助企业实现财务管理的数字化和智能化。通过本系统，企业可以提高财务管理效率，减少人工工作量，确保财务数据的准确性，为决策提供数据支持。

财务系统是企业管理的重要组成部分，本设计方案旨在为餐食关系系统提供一个功能完善、易于使用的财务模块，满足企业的日常财务管理需求。
